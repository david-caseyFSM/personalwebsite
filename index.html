<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>David Kendall Casey</title>
    <link href="https://fonts.cdnjs.com/css2?family=Sorts+Mill+Goudy:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
    <style>
        body {
            background: black;
            color: white;
            font-family: 'Sorts Mill Goudy', Georgia, serif;
            margin: 0;
            padding: 0;
            line-height: 1.7;
            font-size: 18px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        header {
            text-align: center;
            padding: 6rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            font-size: 3rem;
            font-weight: normal;
            margin: 0;
        }

        h2 {
            font-size: 2.2rem;
			font-style: italic;
            font-weight: normal;
			text-align: center;
            margin: 2rem 0;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        h3 {
            font-size: 1.5rem;
            font-weight: normal;
            margin: 2rem 0;
        }

        nav {
            text-align: center;
            padding: 1.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
			margin-bottom: 2rem;
        }

        nav a {
            color: white;
            text-decoration: none;
            margin: 0 1.5rem;
            font-size: 1.2rem;
        }

        nav a:hover {
            opacity: 0.7;
        }

        blockquote {
            border-left: 2px solid white;
            margin: 0;
            padding-left: 1.5rem;
        }

        .source {
            text-align: right;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 1rem;
        }

        .work-title {
            font-style: italic;
        }

        .quote-container {
            margin-bottom: 4rem;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.8s ease forwards;
        }
		
		.quote-header a {
			color: white;
			text-decoration: underline;
		}

		.quote-header a:hover {
			color: lightgray;
		}

        .subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.2rem;
            margin-top: 1rem;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .category-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9em;
            margin-left: 0.5em;
        }

        @media (max-width: 768px) {
            body {
                font-size: 16px;
            }

            nav a {
                display: block;
                margin: 0.5rem 0;
            }

            header {
                padding: 3rem 1rem;
            }

            h1 {
                font-size: 2.5rem;
			}
			
        .search-container {
			position: fixed;
			top: 0;
			right: 0;
			padding: 1rem;
			width: auto;
			background: transparent; 
			box-shadow: none; 
			z-index: 1000;
		}

		.search-form {
			display: flex;
			gap: 0.5rem;
		}

		.search-input {
			padding: 0.5rem 1rem;
			border: none; /* Removed border */
			border-radius: 4px;
			font-size: 1rem;
			background-color: #f3f4f6; /* Added light gray background */
		}

		.search-input:focus {
			outline: none;
			border-color: #007bff;
		}

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            max-width: 600px;
            margin: 0.5rem auto;
            background: white;
            border-radius: 4px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: none;
        }

        .result-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }

        .result-item:hover {
            background: #f5f5f5;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-title {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .result-preview {
            font-size: 0.9rem;
            color: #666;
        }

        .highlight {
            background-color: yellow;
            padding: 0 2px;
    }
    </style>
   <script>
			// Function to fetch quotes from a specified URL
		async function fetchQuotesFromPage(url) {
		  try {
			const response = await fetch(url);
			const text = await response.text();

			// Create a temporary DOM parser to extract blockquotes
			const parser = new DOMParser();
			const doc = parser.parseFromString(text, 'text/html');
			const quotes = doc.querySelectorAll('.quote-entry');

			// Return quotes as an array of objects including the source URL
			return Array.from(quotes).map(quote => ({
			  element: quote,
			  sourcePage: url
			}));
		  } catch (error) {
			console.error(`Failed to fetch quotes from ${url}:`, error);
			return [];
		  }
		}

		// Function to display a daily random quote
		async function displayDailyQuote() {
		  const pagesToSearch = ['commonplace.html', 'on-art.html', 'on-age.html', 'on-beauty.html', 'on-benevolence.html']; // Add all your pages here
		  let allQuotes = [];

		  // Fetch quotes from all specified pages
		  for (const page of pagesToSearch) {
			const quotes = await fetchQuotesFromPage(page);
			allQuotes = allQuotes.concat(quotes);
		  }

		  // If no quotes were found, log an error
		  if (allQuotes.length === 0) {
			console.error('No quotes found on specified pages.');
			return;
		  }

		  // Get the current time in milliseconds
		  const currentTime = new Date().getTime();

		  // Retrieve the time of the last quote change and the last quote index from localStorage
		  const lastQuoteTime = localStorage.getItem('lastQuoteTime');
		  const lastQuoteIndex = localStorage.getItem('lastQuoteIndex');
		  
		  let randomIndex;

		  // If more than 24 hours have passed, select a new quote
		  if (!lastQuoteTime || currentTime - lastQuoteTime > 86400000) {
			randomIndex = Math.floor(Math.random() * allQuotes.length);
			localStorage.setItem('lastQuoteIndex', randomIndex);
			localStorage.setItem('lastQuoteTime', currentTime);
		  } else {
			randomIndex = parseInt(lastQuoteIndex, 10);
		  }

		  // Extract the selected quote
		  const selectedQuote = allQuotes[randomIndex];
		  const quoteText = selectedQuote.element.querySelector('blockquote').textContent.trim();
		  const sourceText = selectedQuote.element.querySelector('.source').textContent.trim();

		  // Extract the page name from the URL
		  const pageName = selectedQuote.sourcePage.split('/').pop().split('.')[0].replace(/-/g, ' ');
		  const pageHeader = `From '${pageName.charAt(0).toUpperCase() + pageName.slice(1)}'`;

		  // Format and display the header
		  const header = document.getElementById('quote-header');
		  header.innerHTML = `From <a href="commonplace.html" target="_blank" style="color: inherit; text-decoration: none;">Commonplace Book</a>, &ldquo;${pageName.charAt(0).toUpperCase() + pageName.slice(1)}&rdquo;`;

		  // Display the quote
		  document.getElementById('quote-text').textContent = `${quoteText}`;
		  document.getElementById('quote-source').textContent = `â€” ${sourceText}`;
		}

		// Call the function when the page loads
		window.onload = displayDailyQuote;
	</script>
	<script>
        let searchIndex = null;

        // Load the search index when the page loads
        window.addEventListener('load', async () => {
            try {
                const response = await fetch('/search-index.json');
                searchIndex = await response.json();
            } catch (error) {
                console.error('Failed to load search index:', error);
            }
        });

        // Debounce function to limit search frequency
        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }

        // Handle search input with debounce
        const debounceSearch = debounce((event) => {
            const searchTerm = event.target.value;
            if (searchTerm.length >= 2) {
                performSearch(searchTerm);
            } else {
                hideResults();
            }
        }, 300);

        // Handle form submission
        function handleSearch(event) {
            event.preventDefault();
            const searchTerm = event.target.querySelector('input').value;
            if (searchTerm) {
                performSearch(searchTerm);
            }
        }

        // Perform the search
        function performSearch(searchTerm) {
            if (!searchIndex) {
                displayResults([{
                    title: 'Error',
                    preview: 'Search index not loaded. Please try again later.',
                    url: '#'
                }]);
                return;
            }

            const searchRegex = new RegExp(searchTerm, 'gi');
            const results = searchIndex
                .filter(page => {
                    return page.title.match(searchRegex) || 
                           page.content.match(searchRegex);
                })
                .map(page => {
                    // Find the first match in content for preview
                    const contentMatch = page.content.toLowerCase().indexOf(searchTerm.toLowerCase());
                    let preview = page.preview;
                    
                    if (contentMatch !== -1) {
                        const start = Math.max(0, contentMatch - 50);
                        const end = Math.min(page.content.length, contentMatch + 100);
                        preview = '...' + page.content.slice(start, end) + '...';
                    }
                    
                    // Highlight matches
                    preview = preview.replace(searchRegex, match => 
                        `<span class="highlight">${match}</span>`
                    );
                    
                    return {
                        title: page.title.replace(searchRegex, match => 
                            `<span class="highlight">${match}</span>`
                        ),
                        preview,
                        url: page.url
                    };
                })
                .slice(0, 5); // Limit to top 5 results

            displayResults(results);
        }

        // Display search results
        function displayResults(results) {
            const resultsContainer = document.getElementById('searchResults');
            resultsContainer.innerHTML = '';
            
            if (results.length === 0) {
                resultsContainer.innerHTML = '<div class="result-item">No results found</div>';
                resultsContainer.style.display = 'block';
                return;
            }
            
            results.forEach(result => {
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                resultItem.innerHTML = `
                    <div class="result-title">${result.title}</div>
                    <div class="result-preview">${result.preview}</div>
                `;
                resultItem.addEventListener('click', () => {
                    window.location.href = result.url;
                });
                resultsContainer.appendChild(resultItem);
            });
            
            resultsContainer.style.display = 'block';
        }

        // Hide results container
        function hideResults() {
            document.getElementById('searchResults').style.display = 'none';
        }

        // Close results when clicking outside
        document.addEventListener('click', (event) => {
            if (!event.target.closest('.search-container')) {
                hideResults();
            }
        });
    </script>
</head>
<body>
    <header>
        <h1>David Kendall Casey</h1>
        <p class="subtitle">Medical Student, Writer</p>
		 <div class="search-container">
        <form class="search-form" onsubmit="handleSearch(event)">
            <input 
                type="search" 
                class="search-input" 
                placeholder="Search entire site..." 
                aria-label="Search"
                onkeyup="debounceSearch(event)"
            >
        </form>
        <div class="search-results" id="searchResults"></div>
    </div>
    </header>

    <nav>
        <a href="index.html">Home</a>
        <a href="commonplace.html">Commonplace Book</a>
        <a href="#">Writing</a>
        <a href="#">Speaking</a>
        <a href="#">Research</a>
    </nav>

	<h2>Daily quote</h2>
    <main class="container">
        <div id="quote-of-the-day">
			<p id="quote-header"></p> <!-- This is the new header for the source page -->
			<blockquote id="quote-text"></blockquote>
			<p id="quote-source"></p>
		</div>
    </main>
</body>
</html>